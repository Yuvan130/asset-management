extends ../layout

block content
  h1 Employees
  button.btn.btn-primary.mb-3(data-toggle='modal', data-target='#addEmployeeModal') Add Employee
  table#employeesTable.table.table-striped
    thead
      tr
        th ID
        th Name
        th Email
        th Status
        th Actions
    tbody
      each employee in employees
        tr
          td= employee.id
          td= employee.name
          td= employee.email
          td= employee.isActive ? 'Active' : 'Inactive'
          td
            button.btn.btn-sm.btn-info.mr-2(data-id=employee.id, data-toggle='modal', data-target='#editEmployeeModal') Edit
            button.btn.btn-sm.btn-danger(data-id=employee.id, onclick='deleteEmployee(event)') Delete

  // Add Employee Modal
  #addEmployeeModal.modal.fade
    .modal-dialog
      .modal-content
        .modal-header
          h5.modal-title Add Employee
          button.close(data-dismiss='modal') &times;
        .modal-body
          form#addEmployeeForm
            .form-group
              label(for='name') Name
              input#name.form-control(type='text', name='name', required)
            .form-group
              label(for='email') Email
              input#email.form-control(type='email', name='email', required)
            .form-group
              .form-check
                input#isActive.form-check-input(type='checkbox', name='isActive', checked)
                label.form-check-label(for='isActive') Active
        .modal-footer
          button.btn.btn-secondary(data-dismiss='modal') Close
          button.btn.btn-primary#addEmployeeFormSubmit(type='submit') Add Employee

  // Edit Employee Modal
  #editEmployeeModal.modal.fade
    .modal-dialog
      .modal-content
        .modal-header
          h5.modal-title Edit Employee
          button.close(data-dismiss='modal') &times;
        .modal-body
          form#editEmployeeForm
            input#editEmployeeId(type='hidden', name='id')
            .form-group
              label(for='editName') Name
              input#editName.form-control(type='text', name='name', required)
            .form-group
              label(for='editEmail') Email
              input#editEmail.form-control(type='email', name='email', required)
            .form-group
              .form-check
                input#editIsActive.form-check-input(type='checkbox', name='isActive')
                label.form-check-label(for='editIsActive') Active
        .modal-footer
          button.btn.btn-secondary(data-dismiss='modal') Close
          button.btn.btn-primary#editEmployeeFormSubmit(type='submit') Save Changes

block scripts
  script.
    $(document).ready(function() {
      $('#employeesTable').DataTable();
      
      // Add Employee Form Submission
      $('#addEmployeeFormSubmit').on('click', function(e) {
        e.preventDefault();
        console.log('Add form submitted'); // Debugging log
        $.ajax({
          url: '/',
          method: 'POST',
          data: $('#addEmployeeForm').serialize(),
          success: function() {
            console.log('Employee added successfully'); // Debugging log
            location.reload();
          },
          error: function() {
            alert('Failed to add employee.');
          }
        });
      });

      // Edit Employee Form Submission
      $('#editEmployeeFormSubmit').on('click', function(e) {
        e.preventDefault();
        console.log('Edit form submitted'); // Debugging log
        const id = $('#editEmployeeId').val();
        $.ajax({
          url: '/' + id,
          method: 'PUT',
          data: $('#editEmployeeForm').serialize(),
          success: function() {
            console.log('Employee updated successfully'); // Debugging log
            location.reload();
          },
          error: function() {
            alert('Failed to update employee.');
          }
        });
      });

      // Populate Edit Form with Employee Data
      $('#editEmployeeModal').on('show.bs.modal', function(event) {
        var button = $(event.relatedTarget); // Button that triggered the modal
        var id = button.data('id'); // Extract info from data-id attribute
        
        // Fetch employee data and populate the form
        $.ajax({
          url: '/employees/' + id,
          method: 'GET',
          success: function(data) {
                        $('#editEmployeeId').val(data.id);
            $('#editName').val(data.name);
            $('#editEmail').val(data.email);
            $('#editIsActive').prop('checked', data.isActive);
          },
          error: function() {
            alert('Failed to fetch employee data.');
          }
        });
      });
    });

    function deleteEmployee(event) {
      var id = $(event.target).data('id');
      
      if (confirm('Are you sure you want to delete this employee?')) {
        $.ajax({
          url: '/' + id,
          method: 'DELETE',
          success: function() {
            console.log('Employee deleted successfully'); // Debugging log
            location.reload();
          },
          error: function() {
            alert('Failed to delete the employee.');
          }
        });
      }
    }

