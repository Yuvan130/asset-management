extends ../layout

block content
  h1 Assets

  // Add Asset Button
  button.btn.btn-primary.mb-3(data-toggle='modal', data-target='#addAssetModal') Add Asset

  // Assets Table
  table#assetsTable.table.table-striped
    thead
      tr
        th ID
        th Serial Number
        th Make
        th Model
        th Category
        th Status
        th Actions
    tbody
      each asset in assets
        tr
          td= asset.id
          td= asset.serialNumber
          td= asset.make
          td= asset.model
          td= asset.AssetCategory.name
          td= asset.status
          td
            // Edit Button
            button.btn.btn-sm.btn-info.mr-2(data-id=asset.id, data-toggle='modal', data-target='#editAssetModal') Edit
            // Delete Button
            //- button.btn.btn-sm.btn-danger(data-id=asset.id) Delete
            // History Link
            a.btn.btn-sm.btn-secondary(href=`/asset-history/${asset.id}`) History

  // Add Asset Modal
  #addAssetModal.modal.fade
    .modal-dialog
      .modal-content
        .modal-header
          h5.modal-title Add Asset
          button.close(data-dismiss='modal') &times;
        .modal-body
          form#addAssetForm
            .form-group
              label(for='serialNumber') Serial Number
              input#serialNumber.form-control(type='text', name='serialNumber', required)
            .form-group
              label(for='make') Make
              input#make.form-control(type='text', name='make')
            .form-group
              label(for='model') Model
              input#model.form-control(type='text', name='model')
            .form-group
              label(for='category') Category
              select#category.form-control(name='category')
                option Select
                if assetCategories && assetCategories.length
                  each category in assetCategories
                    option(value=category.id)= category.name
                else
                  option(disabled) No categories found
            .form-group
              label(for='value') Value
              input#value.form-control(type='number', step='0.01', name='value')
        .modal-footer
          button.btn.btn-secondary(data-dismiss='modal') Close
          button.btn.btn-primary#addAssetFormSubmit(type='submit') Add Asset

  // Edit Asset Modal
  #editAssetModal.modal.fade
    .modal-dialog
      .modal-content
        .modal-header
          h5.modal-title Edit Asset
          button.close(data-dismiss='modal') &times;
        .modal-body
          form#editAssetForm
            input#editAssetId(type='hidden', name='id')
            .form-group
              label(for='editSerialNumber') Serial Number
              input#editSerialNumber.form-control(type='text', name='serialNumber', required)
            .form-group
              label(for='editMake') Make
              input#editMake.form-control(type='text', name='make')
            .form-group
              label(for='editModel') Model
              input#editModel.form-control(type='text', name='model')
            .form-group
              label(for='editCategory') Category
              select#editCategory.form-control(name='category')
                each category in assetCategories
                  option(value=category.id)= category.name
            .form-group
              label(for='editValue') Value
              input#editValue.form-control(type='number', step='0.01', name='value')
        .modal-footer
          button.btn.btn-secondary(data-dismiss='modal') Close
          button.btn.btn-primary#editAssetFormSubmit(type='submit') Save Changes

block scripts
  script.
    $(document).ready(function() {
      $('#assetsTable').DataTable();

      // Add Asset Form Submission
      $('#addAssetFormSubmit').on('click', function(e) {
        e.preventDefault();
        var data = $('#addAssetForm').serialize();
        $.ajax({
          type: 'POST',
          url: '/assets',
          data: data,
          success: function(response) {
            location.reload();
          },
          error: function(error) {
            console.error(error);
          }
        });
      });

      // Edit Asset Button Click
      $('#assetsTable').on('click', '.btn-info', function() {
        var assetId = $(this).data('id');
        $.get('/assets/' + assetId, function(asset) {
          $('#editAssetId').val(asset.id);
          $('#editSerialNumber').val(asset.serialNumber);
          $('#editMake').val(asset.make);
          $('#editModel').val(asset.model);
          $('#editCategory').val(asset.asset_category_id);
          $('#editValue').val(asset.value);
        });
      });

      // Edit Asset Form Submission
      $('#editAssetFormSubmit').on('click', function(e) {
        e.preventDefault();
        var assetId = $('#editAssetId').val();
        var data = $('#editAssetForm').serialize();
        $.ajax({
          type: 'PUT',
          url: '/assets/' + assetId,
          data: data,
          success: function(response) {
            location.reload();
          },
          error: function(error) {
            console.error(error);
          }
        });
      });

      // Delete Asset
      $('#assetsTable').on('click', '.btn-danger', function() {
        var assetId = $(this).data('id');
        if (confirm('Are you sure you want to delete this asset?')) {
          $.ajax({
            type: 'DELETE',
            url: '/assets/' + assetId,
            success: function(response) {
              location.reload();
            },
            error: function(error) {
              console.error(error);
            }
          });
        }
      });
    });
